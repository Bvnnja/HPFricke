<nav class="navbar-hgf">
  <div class="navbar-logo">
    <img src="/Imagenes/HPG.png" alt="Hospital Gustavo Fricke" />
    <span>Hospital Gustavo Fricke</span>
  </div>
  <div class="navbar-content-right">
    <ul class="navbar-links">
      <li id="nav-inicio"><a href="../inicio/inicio.html">Inicio</a></li>
      <li id="nav-login"><a href="../login/login.html">Iniciar Sesi√≥n</a></li>
      <li id="nav-registro"><a href="../registro/registro.html">Registrarse</a></li>
      <li id="nav-registrar-paciente" style="display:none;"><a href="../registrar-paciente/registrar-paciente.html">Registrar Paciente</a></li>
      <li id="nav-registrar-incidencias" style="display:none;"><a href="../incidencias/incidencias.html">Registrar Incidencias</a></li>
      <li id="nav-pacientes" style="display:none;"><a href="../pacientes/pacientes.html">Pacientes</a></li>
    </ul>
    <!-- Notificaci√≥n de alertas cr√≠ticas -->
    <div id="navbar-notificacion-critica" style="display:inline-block;position:relative;margin-left:18px;cursor:pointer;">
      <span style="font-size:22px;vertical-align:middle;">üîî</span>
      <span id="navbar-notificacion-contador" style="position:absolute;top:-8px;right:-8px;background:#d32f2f;color:#fff;border-radius:50%;padding:2px 7px;font-size:13px;display:none;">0</span>
    </div>
    <!-- Modal de notificaciones cr√≠ticas -->
    <div id="modal-notificaciones-criticas" style="display:none;position:fixed;top:60px;right:30px;z-index:9999;background:#fff3cd;border:2px solid #ff9800;border-radius:10px;box-shadow:0 2px 8px rgba(255,193,7,0.18);max-width:340px;width:90vw;padding:18px 16px;">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <h3 style="color:#d32f2f;font-size:20px;margin:0;">Notificaciones Cr√≠ticas</h3>
        <div>
          <button id="abrir-configuracion-alerta" style="background:none;border:none;font-size:20px;cursor:pointer;margin-right:8px;" title="Personalizar alerta">‚öôÔ∏è</button>
          <button id="cerrar-modal-notificaciones" style="background:none;border:none;font-size:20px;cursor:pointer;color:#111;">‚úñ</button>
        </div>
      </div>
      <!-- Formulario de configuraci√≥n (oculto por defecto) -->
      <form id="form-configuracion-alerta" style="display:none;margin-top:10px;">
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px;">
          <label for="color-notificacion" style="font-size:15px;min-width:120px;">Color de notificaci√≥n:</label>
          <input type="color" id="color-notificacion" value="#d32f2f" style="width:40px;height:30px;vertical-align:middle;border:none;background:none;box-shadow:0 0 2px #888;">
        </div>
        <div style="display:flex;gap:10px;justify-content:flex-end;">
          <button type="submit" style="background:#1976d2;color:#fff;border:none;padding:6px 18px;border-radius:5px;cursor:pointer;font-weight:500;">Guardar</button>
          <button type="button" id="cancelar-configuracion-alerta" style="background:#b0bec5;color:#263238;border:none;padding:6px 18px;border-radius:5px;cursor:pointer;">Cancelar</button>
        </div>
      </form>
      <ul id="lista-notificaciones-navbar" style="list-style:none;padding:0;margin:14px 0 0 0;max-height:300px;overflow-y:auto;">
        <!-- Se llenar√° con JS -->
      </ul>
    </div>
    <div id="navbar-usuario" class="navbar-usuario" style="display:none;">
      <span id="usuario-nombre"></span>
      <span class="flecha-abajo">‚ñº</span>
      <div id="usuario-menu" class="usuario-menu" style="display:none;">
        <a href="#" id="cerrarSesion">Cerrar Sesi√≥n</a>
      </div>
    </div>
    <!-- Notificaciones internas HU-15 -->
    <div id="notificaciones-internas" style="margin-left:18px;">
      <button onclick="document.getElementById('modal-notificaciones-internas').style.display='block';" style="background:none;border:none;font-size:20px;cursor:pointer;" title="Notificaciones internas">üì©</button>
      <div id="modal-notificaciones-internas" style="display:none;position:fixed;top:80px;right:30px;z-index:9999;background:#e3f2fd;border:2px solid #1976d2;border-radius:10px;box-shadow:0 2px 8px rgba(33,150,243,0.18);max-width:340px;width:90vw;padding:18px 16px;">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <h3 style="color:#1976d2;font-size:20px;margin:0;">Notificaciones Internas</h3>
          <button onclick="document.getElementById('modal-notificaciones-internas').style.display='none';" style="background:none;border:none;font-size:20px;cursor:pointer;color:#111;">‚úñ</button>
        </div>
        <ul id="lista-notificaciones-internas" style="list-style:none;padding:0;margin:14px 0 0 0;max-height:300px;overflow-y:auto;">
          <!-- Se llena con JS -->
        </ul>
      </div>
    </div>
  </div>
</nav>
<script>
  // Solo l√≥gica de color
  function aplicarColorNotificacionesNavbar() {
    let usuario = JSON.parse(localStorage.getItem('usuarioLogueado') || '{}');
    let key = usuario && usuario.nombre ? `configUsuario_${usuario.nombre}` : 'configUsuario_default';
    let config = JSON.parse(localStorage.getItem(key) || '{}');
    let color = config.color || '#d32f2f';
    document.querySelectorAll('.noti-critica-li').forEach(li => {
      li.style.borderColor = color;
      li.style.background = color + '22';
    });
    document.querySelectorAll('.noti-critica-estado').forEach(span => {
      span.style.background = color;
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    const notiDiv = document.getElementById('navbar-notificacion-critica');
    const modal = document.getElementById('modal-notificaciones-criticas');
    const cerrar = document.getElementById('cerrar-modal-notificaciones');
    const formConfig = document.getElementById('form-configuracion-alerta');
    const inputColor = document.getElementById('color-notificacion');
    const btnCancelar = document.getElementById('cancelar-configuracion-alerta');

    if (notiDiv && modal) {
      notiDiv.addEventListener('click', function() {
        modal.style.display = modal.style.display === 'none' ? 'block' : 'none';
        setTimeout(aplicarColorNotificacionesNavbar, 100);
      });
    }
    if (cerrar && modal) {
      cerrar.addEventListener('click', function() {
        modal.style.display = 'none';
      });
    }
    if (formConfig && inputColor) {
      formConfig.onsubmit = function(e) {
        e.preventDefault();
        let usuario = JSON.parse(localStorage.getItem('usuarioLogueado') || '{}');
        let key = usuario && usuario.nombre ? `configUsuario_${usuario.nombre}` : 'configUsuario_default';
        let config = JSON.parse(localStorage.getItem(key) || '{}');
        config.color = inputColor.value;
        localStorage.setItem(key, JSON.stringify(config));
        formConfig.style.display = 'none';
        setTimeout(aplicarColorNotificacionesNavbar, 100);
      };
    }
    if (btnCancelar && formConfig) {
      btnCancelar.onclick = function() {
        formConfig.style.display = 'none';
      };
    }
  });
</script>
